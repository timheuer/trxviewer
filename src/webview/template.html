<!-- Generated by Copilot -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRX Viewer</title>
    <link rel="stylesheet" href="{{codiconsUri}}">
    <link rel="stylesheet" href="{{cssUri}}">
    <link rel="stylesheet" href="{{vscodeElementsCssUri}}">
</head>

<body>
    <div class="header">
        <h1>{{testRun.name}}</h1>
        <p><strong>Started:</strong> {{testRun.times.startFormatted}}</p>
        <p><strong>Finished:</strong> {{testRun.times.finishFormatted}}</p>
        <p><strong>Run by:</strong> {{testRun.runUser}}</p>
    </div>

    <div class="summary">
        <div class="summary-box">
            <div class="stat-card total">
                <span class="stat-value">{{testRun.counters.total}}</span>
                <span class="stat-label">Total tests</span>
            </div>
            <div id="donut-chart" class="donut-chart"></div>
            <div class="stat-card pass-percentage">
                <span class="stat-value">{{passPercentage}}%</span>
                <span class="stat-label">Pass percentage</span>
            </div>
            <div class="stat-card run-duration">
                <span class="stat-value">{{runDuration}}</span>
                <span class="stat-label">Run duration</span>
            </div>
            <div class="stat-card not-reported">
                <span class="stat-value">{{otherCount}}</span>
                <span class="stat-label">Other tests</span>
            </div>
        </div>
    </div>

    <button id="expandAllButton" class="vscode-button">Expand All Sections</button>

    <!-- Failed Tests Section -->
    <div class="test-section">
        <details class="vscode-collapsible" {{#if failedCount}}open{{/if}}>
            <summary>
                <i class="codicon codicon-chevron-right icon-arrow"></i>
                <h2 class="title">
                    Failed Tests ({{failedCount}})
                </h2>
            </summary>
            <div>
                <p>{{failedTests}}</p>
            </div>
        </details>
    </div>

    <!-- Passed Tests Section -->
    <div class="test-section">
        <details class="vscode-collapsible">
            <summary>
                <i class="codicon codicon-chevron-right icon-arrow"></i>
                <h2 class="title">
                    Passed Tests ({{passedCount}})
                </h2>
            </summary>
            <div>
                <p>{{passedTests}}</p>
            </div>
        </details>
    </div>

    <!-- Skipped Tests Section -->
    <div class="test-section">
        <details class="vscode-collapsible">
            <summary>
                <i class="codicon codicon-chevron-right icon-arrow"></i>
                <h2 class="title">
                    Skipped Tests ({{skippedCount}})
                </h2>
            </summary>
            <div>
                <p>{{skippedTests}}</p>
            </div>
        </details>
    </div>

    <!-- Other Tests Section -->
    <div class="test-section">
        <details class="vscode-collapsible">
            <summary>
                <i class="codicon codicon-chevron-right icon-arrow"></i>
                <h2 class="title">
                    Other Tests ({{otherCount}})
                </h2>
            </summary>
            <div>
                <p>{{otherTests}}</p>
            </div>
        </details>
    </div>

    <script src="{{chartsUri}}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const passedCount = parseInt('{{testRun.counters.passed}}');
            const failedCount = parseInt('{{testRun.counters.failed}}');
            const skippedCount = parseInt('{{skippedCount}}');
            const othersCount = parseInt('{{otherCount}}');
            const totalCount = passedCount + failedCount + skippedCount + othersCount;

            const chart = Highcharts.chart('donut-chart', {
                chart: {
                    type: 'pie',
                    backgroundColor: 'transparent',
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    height: 215,
                    width: 215,
                    events: {
                        load: function() {
                            // Add a click event on the chart itself
                            this.container.addEventListener('click', function() {
                                setTimeout(updatePassPercentage, 10);
                            });
                        }
                    }
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                accessibility: {
                    point: {
                        valueSuffix: '%'
                    }
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true,
                        point: {
                            events: {
                                click: function () {
                                    updatePassPercentage();
                                }
                            }
                        }
                    }
                },
                series: [{
                    name: 'Tests',
                    colorByPoint: true,
                    innerSize: '50%',
                    data: [{
                        name: 'Passed',
                        y: passedCount,
                        color: '#388a34'
                    },
                    {
                        name: 'Failed',
                        y: failedCount,
                        color: '#e51400'
                    },
                    {
                        name: 'Skipped',
                        y: skippedCount,
                        color: '#ffcc00'
                    },
                    {
                        name: 'Others',
                        y: othersCount,
                        color: '#848484'
                    }
                    ]
                }],
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',
                    labelFormatter: function () {
                        return this.name + ': ' + this.y;
                    }
                }
            });

            function updatePassPercentage() {
                setTimeout(() => {
                    const selectedPoints = chart.getSelectedPoints();
                    
                    // If no points are selected, display the overall pass percentage
                    if (!selectedPoints || selectedPoints.length === 0) {
                        const passPercent = totalCount > 0 ? ((passedCount / totalCount) * 100).toFixed(2) : '0';
                        document.querySelector('.pass-percentage .stat-value').textContent = `${passPercent}%`;
                        return;
                    }
                    
                    // Calculate pass percentage for selected points only
                    let selectedTotal = 0;
                    let selectedPassed = 0;
                    
                    selectedPoints.forEach(point => {
                        if (point && typeof point.y === 'number') {
                            selectedTotal += point.y;
                            if (point.name === 'Passed') {
                                selectedPassed = point.y;
                            }
                        }
                    });
                    
                    const passPercent = selectedTotal > 0 ? ((selectedPassed / selectedTotal) * 100).toFixed(2) : '0';
                    document.querySelector('.pass-percentage .stat-value').textContent = `${passPercent}%`;
                }, 10);
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const start = new Date('{{testRun.times.startFormatted}}');
            const finish = new Date('{{testRun.times.finishFormatted}}');

            const msToTime = (ms) => {
                const seconds = Math.floor((ms / 1000) % 60);
                const minutes = Math.floor((ms / (1000 * 60)) % 60);
                const hours = Math.floor(ms / (1000 * 60 * 60));
                return `${hours}hrs ${minutes}m ${seconds}s`;
            };
            const duration = msToTime(finish - start);
            document.querySelector('.run-duration .stat-value').textContent = duration;
        });
    </script>
    <script src="{{scriptUri}}"></script>
</body>

</html>